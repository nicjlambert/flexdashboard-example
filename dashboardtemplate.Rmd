---
title: "Car accidents of all types between 1999 and 2007"
output:
  flexdashboard::flex_dashboard:
    navbar:
      - title: "title"
    orientation: columns
    vertical_layout: fill
    theme: lumen
---

```{r}
library(dplyr)
library(leaflet)
library(crosstalk)
library(here)
library(purrr)
library(crosstalk)

# Load Data
load(here::here("data/act_crashes_sa2.rda"))

sd <- SharedData$new(act_crashes_sa2)
```

Map {data-icon="fa-globe-asia"}
=====================================

Column {data-height=2}
-------------------------------------

### Filters

```{r}

filter_slider(
  id = "decile",
  column = "decile",
  label = "Filter areas based on decile rank ",
  sharedData = sd,
  step = 1,
  round = TRUE,
  ticks = TRUE
)

filter_checkbox(
  id = 'bins',
  label = 'Filter areas based on top and/or bottom 10%',
  sharedData = sd,
  group = ~bins
)
```

```{r} 
bscols(
filter_select(
  id = "sa2_name16",
  label="Filter areas based on name",
  sharedData = sd,
  group = ~sa2_name16
)
)
```

### Datatable

```{r}

sd %>% DT::datatable(
  #filter = "top",
  extensions = c("Scroller", "Buttons"),
  rownames = TRUE,
  colnames = c('Statistical Area (SA2)' = 'sa2_name16',
               'Area km^2' = 'areasqkm16',
               'Accidents' = 'crashes',
               'Accidents/km^2' = 'crashes_sq_km',
               'Decile rankings' = 'decile'),
  style = "bootstrap",
  class = "compact",
  width = "100%",
  options = list(
    dom = "Blrtip",
    deferRender = TRUE,
    scrollY = 300,
    scroller = TRUE,
    columnDefs = list(
      list(targets = c(0,1,2,4,5,6,7,8,9,10,11,13,14,16,19), visible = FALSE)),
    buttons = list("csv", "excel"))
)


```

Column {data-width=600}
-------------------------------------

### Maps

```{r}

library(leafem)

# Maps Section
leaflet_options <- leafletOptions(zoomControl = FALSE, attributionControl = FALSE)
tile_options <- tileOptions(minZoom = 8, maxZoom = 11, useCache = TRUE, crossOrigin = TRUE)
highlight_options <- highlightOptions(color = "#008B8B", dashArray = "3", opacity = 1, weight = 2, fillOpacity = 0.7, fillColor = "#008B8B", bringToFront = TRUE)
label_options <- labelOptions(noHide = TRUE, direction = "center", textOnly = TRUE, style = list("font-family" = "Arial", "font-weight" = "bolder", "font-size" = "10px"))

sd %>%
  leaflet(options = leaflet_options) %>%
  setView(lng = 149, lat = -35.46, zoom = 10) %>%
  addProviderTiles(providers$CartoDB.PositronNoLabels, group = "Light", options = tile_options) %>%
  addPolygons(stroke = TRUE, color = "black", dashArray = "1", opacity = 1, weight = 0.5, smoothFactor = 0.2, fillColor = "transparent", fillOpacity = 0.7, label = ~sa2_name16, highlight = highlight_options) %>%
  addCircleMarkers(lng = ~cent_lng, lat = ~cent_lat, stroke = TRUE, weight = 0.5, color = "transparent", fillColor = "transparent", label = purrr::map(glue::glue("<span style ='color:{act_crashes_sa2$color}'>{act_crashes_sa2$crashes_sq_km}<span>"), htmltools::HTML), labelOptions = label_options) %>%
  addMouseCoordinates()
  
  
```





